<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agaonline ğŸ‡¹ğŸ‡· - ArkadaÅŸlarÄ±nla Oyna</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="darkmode.css">
</head>
<body>
    <div id="app">
        <!-- Main Menu Screen -->
        <div id="mainMenu" class="screen active">
            <div class="menu-wrapper">
                <div class="menu-container">
                    <div class="menu-header">
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">
                            <div>
                                <h1 class="game-title">ğŸ’° AGAONLINE ğŸ‡¹ğŸ‡·</h1>
                                <p class="game-subtitle">ArkadaÅŸlarÄ±nla Ã§evrim iÃ§i oyna</p>
                            </div>
                            <button id="darkModeToggle" class="btn-dark-mode" onclick="toggleDarkMode()" title="Tema deÄŸiÅŸtir">ğŸŒ™</button>
                        </div>
                    </div>
                    
                    <div class="menu-form">
                        <input type="text" id="playerNameInput" placeholder="Ä°smini yaz" maxlength="20" class="input-field">

                        <div class="appearance-selector">
                            <label>Tahta seÃ§</label>
                            <select id="boardSelect" class="input-field">
                                <option value="dunya" selected>DÃ¼nya (VarsayÄ±lan)</option>
                                <option value="turkiye">TÃ¼rkiye</option>
                                <option value="amerika">Amerika</option>
                                <option value="avrupa">Avrupa</option>
                                <option value="japonya">Japonya</option>
                                <option value="cin">Ã‡in</option>
                                <option value="kore">Kore</option>
                                <option value="rusya">Rusya</option>
                            </select>
                        </div>
                        
                        <div class="appearance-selector">
                            <label>Avatar seÃ§</label>
                            <div class="avatar-grid">
                                <button class="avatar-btn selected" data-appearance="ğŸ‘¤" onclick="selectAppearance('ğŸ‘¤')">ğŸ‘¤</button>
                                <button class="avatar-btn" data-appearance="ğŸ©" onclick="selectAppearance('ğŸ©')">ğŸ©</button>
                                <button class="avatar-btn" data-appearance="ğŸš—" onclick="selectAppearance('ğŸš—')">ğŸš—</button>
                                <button class="avatar-btn" data-appearance="ğŸ•" onclick="selectAppearance('ğŸ•')">ğŸ•</button>
                                <button class="avatar-btn" data-appearance="ğŸ¸" onclick="selectAppearance('ğŸ¸')">ğŸ¸</button>
                                <button class="avatar-btn" data-appearance="ğŸ‘‘" onclick="selectAppearance('ğŸ‘‘')">ğŸ‘‘</button>
                                <button class="avatar-btn" data-appearance="ğŸ¤“" onclick="selectAppearance('ğŸ¤“')">ğŸ¤“</button>
                                <button class="avatar-btn" data-appearance="ğŸ§™" onclick="selectAppearance('ğŸ§™')">ğŸ§™</button>
                                <button class="avatar-btn" data-appearance="ğŸ‡" onclick="selectAppearance('ğŸ‡')">ğŸ‡</button>
                                <button class="avatar-btn" data-appearance="ğŸ§›" onclick="selectAppearance('ğŸ§›')">ğŸ§›</button>
                                <button class="avatar-btn" data-appearance="ğŸ‘»" onclick="selectAppearance('ğŸ‘»')">ğŸ‘»</button>
                                <button class="avatar-btn" data-appearance="ğŸ¤–" onclick="selectAppearance('ğŸ¤–')">ğŸ¤–</button>
                            </div>
                        </div>



                        <div class="menu-buttons">
                            <button onclick="createLobby()" class="btn-primary">Oyun OluÅŸtur</button>
                            <button onclick="joinRandomLobby()" class="btn-secondary">Oyuna KatÄ±l</button>
                        </div>
                    </div>
                </div>

                <div class="lobbies-panel">
                    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
                        <h3 style="margin:0;">ğŸ® Aktif Oyunlar</h3>
                        <button class="btn-ghost" onclick="refreshLobbies()" style="padding:6px 10px;">Yenile</button>
                    </div>
                    <div id="lobbiesList" class="lobbies-list-large"></div>
                </div>
            </div>
        </div>

        <!-- Join Screen -->
        <div id="joinScreen" class="screen">
            <div class="join-container">
                <h2>Lobiye KatÄ±l</h2>
                <input type="text" id="lobbyIdInput" placeholder="Lobi ID yaz" class="input-field">
                <div class="menu-buttons">
                    <button onclick="joinLobby()" class="btn-primary">KatÄ±l</button>
                    <button onclick="showMenu()" class="btn-secondary">Geri</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="game-container">
                <!-- Main Content -->
                <div class="game-content">
                    <!-- Left Panel - Players & Setup -->
                    <div class="left-panel">
                        <div class="panel-section" style="gap: 6px; padding-bottom: 6px;">
                            <h2 id="lobbyStatus" style="margin-bottom: 4px; font-size: 1.2em;">Oyun Lobisi</h2>
                            <div id="playerCount" class="player-count">Oyuncu: 1/12</div>
                            <div id="boardName" class="player-count" style="font-size: 0.9em; opacity: 0.8;"></div>
                            <div id="lobbyIdDisplay" class="player-count" style="font-size: 0.85em; opacity: 0.8;"></div>
                            <button id="copyLobbyIdBtn" onclick="copyCurrentLobbyId()" class="btn-ghost" style="width:100%; display:none;">ID Kopyala</button>
                            <button onclick="leaveGame()" class="btn-leave" style="width: 100%; margin-top: 6px;">Ã‡Ä±kÄ±ÅŸ</button>
                        </div>

                        <div class="panel-section players-section">
                            <h3>ğŸ‘¥ Oyuncular</h3>
                            <div id="playersList" class="players-list"></div>
                        </div>

                        <div class="panel-section events-section" style="display: none;">
                            <h3>ğŸ“œ Olaylar</h3>
                            <div id="eventLog" class="event-log"></div>
                        </div>

                        <div class="panel-section color-selector-lobby" id="colorSelectorPanel">
                            <h3>ğŸ¨ Renk SeÃ§</h3>
                            <div class="color-grid">
                                <button class="color-btn selected" data-color="#ef4444" style="background: #ef4444;" onclick="selectColorLobby('#ef4444')"></button>
                                <button class="color-btn" data-color="#f97316" style="background: #f97316;" onclick="selectColorLobby('#f97316')"></button>
                                <button class="color-btn" data-color="#eab308" style="background: #eab308;" onclick="selectColorLobby('#eab308')"></button>
                                <button class="color-btn" data-color="#22c55e" style="background: #22c55e;" onclick="selectColorLobby('#22c55e')"></button>
                                <button class="color-btn" data-color="#3b82f6" style="background: #3b82f6;" onclick="selectColorLobby('#3b82f6')"></button>
                                <button class="color-btn" data-color="#8b5cf6" style="background: #8b5cf6;" onclick="selectColorLobby('#8b5cf6')"></button>
                                <button class="color-btn" data-color="#ec4899" style="background: #ec4899;" onclick="selectColorLobby('#ec4899')"></button>
                                <button class="color-btn" data-color="#06b6d4" style="background: #06b6d4;" onclick="selectColorLobby('#06b6d4')"></button>
                                <button class="color-btn" data-color="#10b981" style="background: #10b981;" onclick="selectColorLobby('#10b981')"></button>
                                <button class="color-btn" data-color="#f59e0b" style="background: #f59e0b;" onclick="selectColorLobby('#f59e0b')"></button>
                                <button class="color-btn" data-color="#6366f1" style="background: #6366f1;" onclick="selectColorLobby('#6366f1')"></button>
                                <button class="color-btn" data-color="#14b8a6" style="background: #14b8a6;" onclick="selectColorLobby('#14b8a6')"></button>
                            </div>
                        </div>
                        
                        <div class="panel-section setup-section" id="setupPanel">
                            <h3>âš™ï¸ Host AyarlarÄ±</h3>
                            <div class="game-rules">
                                <label>
                                    <input type="checkbox" id="ruleTaxFree" onchange="updateRules()"> Vergi Muafiyeti
                                </label>
                                <label>
                                    <input type="checkbox" id="ruleFastMode" onchange="updateRules()"> HÄ±zlÄ± Mod (2x Para)
                                </label>
                                <label>
                                    <input type="checkbox" id="ruleFreeParkingBonus" onchange="updateRules()"> Ãœcretsiz Park Bonusu
                                </label>
                                <label>
                                    <input type="checkbox" id="ruleNoAuctions" onchange="updateRules()"> MÃ¼zayede Yok
                                </label>
                                <label style="margin-top: 10px;">
                                    BaÅŸlangÄ±Ã§ ParasÄ±: â‚º<span id="initialMoney">2000</span>
                                    <input type="range" id="initialMoneySlider" min="500" max="10000" step="100" value="2000" onchange="updateInitialMoney()" class="money-slider" style="margin-top: 8px; width: 100%;">
                                </label>
                                <label>
                                    BAÅLA ParasÄ±: â‚º<span id="goMoney">200</span>
                                    <input type="range" id="goMoneySlider" min="100" max="1000" step="50" value="200" onchange="updateGoMoney()" class="money-slider" style="margin-top: 8px; width: 100%;">
                                </label>
                                <label>
                                    Ev Fiyat Ã‡arpanÄ±: x<span id="houseMultiplier">0.5</span>
                                    <input type="range" id="houseMultiplierSlider" min="0.25" max="1" step="0.25" value="0.5" onchange="updateHouseMultiplier()" class="money-slider" style="margin-top: 8px; width: 100%;">
                                </label>
                                <label>
                                    Tur SÃ¼re Limiti: <span id="turnTimeLimit">60</span> saniye
                                    <input type="range" id="turnTimeLimitSlider" min="30" max="180" step="10" value="60" onchange="updateTurnTimeLimit()" class="money-slider" style="margin-top: 8px; width: 100%;">
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Center - Board -->
                    <div class="center-panel">
                        <div class="board-wrapper">
                            <div id="monopolyBoard" class="monopoly-board">
                                <!-- Board generated by JS -->
                            </div>
                            
                            <!-- Board Center (Dice & Controls) -->
                            <div class="board-center">
                                    <button id="startBtn" class="btn-start" onclick="startGame()" style="display: none;">Oyunu BaÅŸlat</button>
                                <div id="currentTurnDisplay" class="current-turn-info"></div>
                                <div class="dice-display">
                                    <div class="dice-box">
                                        <div id="dice1" class="dice">?</div>
                                        <div id="dice2" class="dice">?</div>
                                    </div>
                                        <div id="diceResult" class="dice-result">ZarÄ± at</div>
                                </div>
                                    <button id="rollBtn" class="btn-roll" onclick="rollDice()" aria-label="Zar at" style="display: none;">ğŸ²</button>
                                    <button id="endTurnBtn" class="btn-end-turn" onclick="endTurn()" style="display: none;">SÄ±rayÄ± Bitir</button>

                                <!-- Board Event Log -->
                                <div id="boardEventDisplay" class="board-event-display" style="margin-top: 15px; max-height: 80px; overflow: hidden;"></div>
                            </div>
                            
                            <!-- Board Event Log (Overlay) -->
                            <div id="boardEventLog" class="board-event-log"></div>
                        </div>
                    </div>

                    <!-- Right Panel - Chat & Events -->
                    <div class="right-panel">
                        <div class="panel-section owned-section">
                            <h3>ğŸ  MÃ¼lklerim</h3>
                            <div id="ownedPropertiesList" class="owned-list"></div>
                        </div>

                        <div class="panel-section trade-section">
                            <h3>ğŸ’° Takas Merkezi</h3>
                            <div id="tradeHistoryList" class="trade-history" style="margin-bottom: 10px; max-height: 120px; overflow: auto;"></div>
                            <button onclick="openTradeModal()" class="btn-primary" style="width: 100%;">
                                <span style="font-size: 1.2em;">ğŸ’±</span> Takas Yap
                            </button>
                        </div>

                        <div class="panel-section chat-section">
                            <h3>ğŸ’¬ Sohbet</h3>
                            <div id="chatMessages" class="chat-messages"></div>
                            <div class="chat-input">
                                <input type="text" id="chatInput" placeholder="Mesaj yaz..." onkeypress="handleChatKeypress(event)">
                                <button onclick="sendMessage()" class="btn-send">GÃ¶nder</button>
                        </div>
                    </div>
                </div>

                <!-- Music Control in Game -->
                <div class="game-music-control" style="position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); padding: 8px; border-radius: 8px; display: none;">
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <span style="color: white; font-size: 0.9em;">ğŸµ</span>
                        <input type="range" id="gameMusicVolume" class="music-slider" min="0" max="100" value="50" onchange="setMusicVolume(this.value)" style="width: 60px;">
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Property Popup -->
    <div id="propertyPopup" class="property-popup" style="display: none;">
        <div class="popup-content">
            <h2 id="propName"></h2>
            <div id="propDetails" class="property-details"></div>
            <div id="buildSection" class="build-section" style="display: none;">
                <button id="buildHouseBtn" class="btn-build" onclick="buildHouse()">ğŸ  Ev Dik</button>
                <button id="sellHouseBtn" class="btn-sell" onclick="sellHouse()" style="display: none;">ğŸ’¸ Ev Sat</button>
            </div>
            <div class="popup-actions">
                <button id="buyBtn" class="btn-buy" onclick="buyProperty()" style="display: none;">SatÄ±n Al</button>
                <button onclick="closePopup()" class="btn-close">Kapat</button>
            </div>
        </div>
    </div>

    <!-- Readonly Property Popup -->
    <div id="roPropertyPopup" class="property-popup" style="display: none;">
        <div class="popup-content">
            <h2 id="roPropName"></h2>
            <div id="roPropDetails" class="property-details"></div>
            <div class="popup-actions">
                <button onclick="closeRoPopup()" class="btn-close">Kapat</button>
            </div>
        </div>
    </div>

    <!-- Trade Offer Modal -->
    <div id="tradeOfferModal" class="trade-offer-modal" style="display: none;">
        <div class="trade-offer-overlay"></div>
        <div class="trade-offer-content">
            <h2 style="margin-top: 0; text-align: center;">ğŸ’± Takas Teklifi</h2>
            <div class="trade-offer-sender" id="tradeOfferSender"></div>
            
            <div style="display: flex; gap: 15px; margin: 15px 0; font-size: 0.9em;">
                <div style="flex: 1;">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #FFD700;">Onlar Talep Ediyor</div>
                    <div id="tradeOfferTheirWant" style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; min-height: 40px;"></div>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #FFD700;">Bana Verecek</div>
                    <div id="tradeOfferTheirGive" style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; min-height: 40px;"></div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                <button id="btnAcceptTrade" class="btn-accept-trade" onclick="acceptTradeOffer()">âœ“ Kabul Et</button>
                <button id="btnRejectTrade" class="btn-reject-trade" onclick="rejectTradeOffer()">âœ• Reddet</button>
                <button id="btnCounterOffer" class="btn-counter-trade" onclick="showCounterOfferPanel()">ğŸ”„ KarÅŸÄ± Teklif</button>
            </div>
        </div>
    </div>

    <!-- Counter Offer Panel -->
    <div id="counterOfferPanel" class="counter-offer-panel" style="display: none;">
        <div class="trade-offer-overlay" onclick="closeCounterOfferPanel()" style="cursor: pointer;"></div>
        <div class="trade-offer-content">
            <h2 style="margin-top: 0; text-align: center;">ğŸ”„ KarÅŸÄ± Teklif GÃ¶nder</h2>
            <div class="trade-offer-sender" id="counterOfferTarget"></div>

            <div style="display: flex; gap: 15px; margin: 15px 0; font-size: 0.9em;">
                <div style="flex: 1;">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #FFD700;">Biz Talep Ediyoruz</div>
                    <div id="counterMyWant" class="owned-list" style="max-height: 100px; overflow: auto; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px;"></div>
                    <label style="display: block; margin-top: 6px; font-size: 0.85em;">Para Talep: <input type="number" id="counterMyMoneyWant" class="input-field" style="margin-top: 3px; width: 60px;" min="0" value="0"></label>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #FFD700;">Onlara VereceÄŸiz</div>
                    <div id="counterMyGive" class="owned-list" style="max-height: 100px; overflow: auto; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px;"></div>
                    <label style="display: block; margin-top: 6px; font-size: 0.85em;">Para Verilecek: <input type="number" id="counterMyMoneyGive" class="input-field" style="margin-top: 3px; width: 60px;" min="0" value="0"></label>
                </div>
            </div>

            <div id="counterPropsFromPlayer" style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; margin: 10px 0; border-left: 5px solid rgba(96, 165, 250, 0.6);">
                <div style="font-weight: 700; margin-bottom: 8px; color: #FFD700;">Onun MÃ¼lkleri (SeÃ§)</div>
                <div id="counterAvailableProps" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
            </div>

            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                <button class="btn-accept-trade" onclick="sendCounterOffer()">âœ“ KarÅŸÄ± Teklif GÃ¶nder</button>
                <button class="btn-reject-trade" onclick="closeCounterOfferPanel()">âœ• Ä°ptal</button>
            </div>
        </div>
    </div>

    <!-- Trade Modal -->
    <div id="tradeModal" class="trade-offer-modal" style="display: none;">
        <div class="trade-offer-overlay" onclick="closeTradeModal()" style="cursor: pointer;"></div>
        <div class="trade-offer-content" style="max-width: 600px;">
            <h2 style="margin-top: 0; text-align: center;">ğŸ’± Takas Merkezi</h2>

            <div style="margin-bottom: 20px;">
                <label style="color: rgba(255,255,255,0.8); font-size: 0.9em; margin-bottom: 5px; display: block;">Oyuncu SeÃ§</label>
                <select id="tradeWithPlayer" class="input-field" style="margin-bottom: 10px; width: 100%;" onchange="refreshTradeLists()">
                    <option>Oyuncu seÃ§...</option>
                </select>
            </div>

            <div style="display:flex; gap:15px; margin:15px 0;">
                <div style="flex:1;">
                    <div style="font-weight:700; margin-bottom:8px; color: #FFD700;">Benim MÃ¼lklerim</div>
                    <div id="myPropsForTrade" class="owned-list" style="max-height:120px; overflow:auto; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px;"></div>
                    <label style="display:block; margin-top:8px; font-size:0.9em;">Benim Para: <input type="number" id="tradeMoneyOffer" class="input-field" style="margin-top:4px;" min="0" value="0"></label>
                </div>
                <div style="flex:1;">
                    <div style="font-weight:700; margin-bottom:8px; color: #FFD700;">KarÅŸÄ± Taraf</div>
                    <div id="theirPropsForTrade" class="owned-list" style="max-height:120px; overflow:auto; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px;"></div>
                    <label style="display:block; margin-top:8px; font-size:0.9em;">OnlarÄ±n Para: <input type="number" id="tradeMoneyRequest" class="input-field" style="margin-top:4px;" min="0" value="0"></label>
                </div>
            </div>

            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="btnProposeTrade" class="btn-accept-trade" onclick="proposeTrade()" disabled>
                    <span style="font-size: 1.2em;">ğŸ’±</span> Teklif GÃ¶nder
                </button>
                <button class="btn-reject-trade" onclick="closeTradeModal()">âœ• Ä°ptal</button>
            </div>
        </div>
    </div>

    <!-- Jail Modal -->
    <div id="jailModal" class="trade-offer-modal" style="display: none;">
        <div class="trade-offer-overlay" onclick="closeJailModal()" style="cursor: pointer;"></div>
        <div class="trade-offer-content" style="max-width: 400px;">
            <h2 style="margin-top: 0; text-align: center;">ğŸ‘® Hapishane</h2>

            <div style="text-align: center; margin: 20px 0;">
                <p>Hapishanedesin! Ã‡Ä±kmak iÃ§in aÅŸaÄŸÄ±daki seÃ§eneklerden birini kullanabilirsin:</p>
                <div id="jailTurnsLeft" style="margin: 10px 0; font-weight: bold;"></div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="btn-primary" onclick="payJailFine()" style="width: 100%;">ğŸ’° 100 TL Ã–de</button>
                <button class="btn-secondary" onclick="rollForJail()" style="width: 100%;">ğŸ² Ã‡ift Zar At</button>
                <button class="btn-ghost" onclick="closeJailModal()" style="width: 100%;">â³ Bekle (Otomatik Ã§Ä±kÄ±ÅŸ)</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="game.js"></script>
</body>
</html>
